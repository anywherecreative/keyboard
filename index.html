<!doctype HTML>
<html>
<head>
    <title>
        Sounds
    </title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

</head>
<body>
<h1>Sounds!</h1>

<button data-tone="a">A</button>
<button data-tone="b">B</button>
<button data-tone="c">C</button>
<button data-tone="d">D</button>
<button data-tone="e">E</button>
<button data-tone="f">F</button>
<button data-tone="g">G</button>

<label>
    <input type="checkbox" id="keyboard"> Play with Keyboard
</label>

<label>
    <button id="record">Record</button>
</label>

<label>
    <button id="play">Play</button>
</label>

<script
        src="http://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<script>
    var recording = [];
    var isRecording = false;
    var recordingOffset = null;
    var playback = false;
    var position = 0;
    function play(tone) {
        var audio = new Audio('wav/'+tone+'.wav');
        audio.play();

        if(isRecording) {
            recording.push({
                offset: new Date() - recordingOffset,
                tone: tone
            });
            recordingOffset = + new Date();
        }
    }

    $(document).ready(function() {
        $('[data-tone]').mousedown(function() {
            play($(this).data('tone'));
        })
    })

    $(document).keydown(function(e){
        if($('#keyboard').is(':checked')) {
            var validKeys = ['a','b','c','d','e','f','g'];
            if(validKeys.includes(e.key)) {
                play(e.key);
            }
        }
    });

    $('#record').click(function() {
        if(isRecording) {
            recordingOffset = null;
            isRecording = false;
            $(this).text('Record');
        }
        else {
            recordingOffset = + new Date();
            isRecording = true;
            $(this).text('Stop');
        }
    })

    $('#play').click(function() {
        $('#this').text('Stop');
        playback = true;
        setTimeout(function() {replay()}, recording[position].offset);
    });

    function replay() {
        if(playback) {
            play(recording[position].tone);
            position++;

            if(recording.length == position) {
                playback = false;
            }
            else {
                setTimeout(function() {replay()}, recording[position].offset);
            }
        }
    }
</script>
</body>
</html>